<!--begin::Main-->
<div class="d-flex flex-column flex-root">
    <!--begin::Authentication - New password -->
    <div class="d-flex flex-column flex-column-fluid bgi-position-y-bottom position-x-center bgi-no-repeat bgi-size-contain bgi-attachment-fixed" style="background-image: url(assets/media/illustrations/sketchy-1/14.png); height: 100vh;">
        <!--begin::Content-->
        <div class="d-flex flex-center flex-column flex-column-fluid p-10 pb-lg-20">
            <!--begin::Logo-->
            <a href="../../demo1/dist/index.html" class="mb-12">
                <img alt="Logo" src="assets/media/logos/logo-1.svg" class="h-40px" />
            </a>
            <!--end::Logo-->
            <!--begin::Wrapper-->
            <div class="w-lg-550px bg-body rounded shadow-sm p-10 p-lg-15 mx-auto">
                
                <!--begin::Success Card-->
                <div *ngIf="passwordResetSuccess" class="card border-0">
                    <div class="card-body text-center p-10">
                        <!--begin::Icon-->
                        <div class="mb-9">
                            <i class="fa fa-check-circle fs-5tx text-success">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                        </div>
                        <!--end::Icon-->
                        
                        <!--begin::Title-->
                        <h1 class="fw-bolder text-gray-900 mb-5">¡Contraseña Restablecida!</h1>
                        <!--end::Title-->
                        
                        <!--begin::Message-->
                        <div class="fw-semibold fs-6 text-gray-500 mb-10">
                            Tu contraseña ha sido restablecida exitosamente.
                            <br>
                            Ya puedes iniciar sesión con tu nueva contraseña.
                        </div>
                        <!--end::Message-->
                        
                        <!--begin::Action-->
                        <button 
                            type="button"
                            (click)="goToLogin()"
                            class="btn btn-lg btn-primary fw-bolder">
                            Ir al inicio de sesión
                        </button>
                        <!--end::Action-->
                    </div>
                </div>
                <!--end::Success Card-->

                <!--begin::Form-->
                <form *ngIf="!passwordResetSuccess" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="form w-100">
                    <!--begin::Heading-->
                    <div class="text-center mb-10">
                        <!--begin::Title-->
                        <h1 class="text-dark mb-3">Restablece tu contraseña</h1>
                        <!--end::Title-->
                        <!--begin::Link-->
                        <div class="text-gray-400 fw-bold fs-6">Ingresa tu nueva contraseña</div>
                        <!--end::Link-->
                    </div>
                    <!--end::Heading-->

                    <!--begin::Error Message-->
                    <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center mb-10">
                        <i class="fa fa-times-circle fs-2hx text-danger me-4">
                            <span class="path1"></span>
                            <span class="path2"></span>
                            <span class="path3"></span>
                        </i>
                        <div class="d-flex flex-column">
                            <span class="fw-semibold">{{ errorMessage }}</span>
                        </div>
                    </div>
                    <!--end::Error Message-->

                    <!--begin::Input group - Password-->
                    <div class="fv-row mb-4">
                        <label class="form-label fw-bolder text-dark fs-6">Nueva Contraseña</label>
                        <div class="position-relative">
                            <input 
                                [type]="showPassword ? 'text' : 'password'" 
                                class="form-control form-control-lg form-control-solid" 
                                formControlName="password"
                                placeholder="Mínimo 8 caracteres"
                                autocomplete="new-password" />
                            <button 
                                type="button" 
                                class="btn btn-icon btn-sm btn-active-color-primary position-absolute end-0 top-50 translate-middle-y me-2"
                                (click)="togglePasswordVisibility()">
                                <i class="ki-duotone ki-eye{{ showPassword ? '-slash' : '' }} fs-2">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                    <span class="path3" *ngIf="showPassword"></span>
                                </i>
                            </button>
                        </div>
                        
                        <!-- Password Strength Indicator -->
                        <div *ngIf="resetPasswordForm.get('password')?.value" class="d-flex align-items-center mt-3">
                            <div class="flex-grow-1 bg-secondary bg-active-state-light rounded h-5px me-3">
                                <div 
                                    class="rounded h-5px" 
                                    [ngClass]="getPasswordStrengthColor()"
                                    [style.width.%]="getPasswordStrength() * 25"></div>
                            </div>
                            <div class="fw-semibold text-muted fs-7">{{ getPasswordStrengthText() }}</div>
                        </div>
                        
                        <div class="text-muted fs-7 mt-2">
                            Use 8 o más caracteres con mayúsculas, minúsculas y números.
                        </div>
                    </div>
                    <!--end::Input group-->

                    <!--begin::Input group - Confirm Password-->
                    <div class="fv-row mb-10">
                        <label class="form-label fw-bolder text-dark fs-6">Confirmar Contraseña</label>
                        <div class="position-relative">
                            <input 
                                [type]="showConfirmPassword ? 'text' : 'password'" 
                                class="form-control form-control-lg form-control-solid" 
                                formControlName="confirmPassword"
                                placeholder="Repita su contraseña"
                                autocomplete="new-password" />
                            <button 
                                type="button" 
                                class="btn btn-icon btn-sm btn-active-color-primary position-absolute end-0 top-50 translate-middle-y me-2"
                                (click)="toggleConfirmPasswordVisibility()">
                                <i class="ki-duotone ki-eye{{ showConfirmPassword ? '-slash' : '' }} fs-2">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                    <span class="path3" *ngIf="showConfirmPassword"></span>
                                </i>
                            </button>
                        </div>
                    </div>
                    <!--end::Input group-->

                    <!--begin::Action-->
                    <div class="d-grid mb-10">
                        <button 
                            type="submit" 
                            class="btn btn-lg btn-primary fw-bolder"
                            [disabled]="isSubmitting || resetPasswordForm.invalid || !resetToken">
                            <span *ngIf="!isSubmitting">Restablecer Contraseña</span>
                            <span *ngIf="isSubmitting">
                                Por favor espera...
                                <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                            </span>
                        </button>
                    </div>
                    <!--end::Action-->

                    <!--begin::Link-->
                    <div class="text-center">
                        <a routerLink="/login" class="link-primary fw-bold">Volver al inicio de sesión</a>
                    </div>
                    <!--end::Link-->
                </form>
                <!--end::Form-->
            </div>
            <!--end::Wrapper-->
        </div>
        <!--end::Content-->
    </div>
    <!--end::Authentication - New password-->
</div>
<!--end::Main-->
