<!--begin::Main-->
		<div class="d-flex flex-column flex-root">
			<!--begin::Authentication - Sign-in -->
			<div class="d-flex flex-column flex-column-fluid bgi-position-y-bottom position-x-center bgi-no-repeat bgi-size-contain bgi-attachment-fixed" style="background-image: url(assets/media/illustrations/sketchy-1/14.png); height: 100vh;">
				<!--begin::Content-->
				<div class="d-flex flex-center flex-column flex-column-fluid p-10 pb-lg-20">
					<!--begin::Logo-->
					<a href="../../demo1/dist/index.html" class="mb-12">
						<img alt="Logo" src="assets/media/logos/logo-1.svg" class="h-60px" />
					</a>
					<!--end::Logo-->
					<!--begin::Wrapper-->
					<div class="w-lg-500px bg-body rounded shadow-sm p-10 p-lg-15 mx-auto" id="contenedor-login">
						
						<!-- Paso 0: Seleccionar cuenta guardada -->
						<div *ngIf="currentStep === LoginStep.SELECT_ACCOUNT" class="fade-in">
							<div class="text-center mb-11">
								<h1 class="text-gray-900 fw-bolder mb-3">Bienvenido de nuevo</h1>
								<div class="text-gray-500 fw-semibold fs-6">Selecciona una cuenta para continuar</div>
							</div>

							<!-- Lista de cuentas guardadas -->
							<div class="mb-10">
								<div *ngFor="let account of savedAccounts" 
									class="d-flex align-items-center mb-5 p-5 rounded border border-gray-300 border-hover cursor-pointer hover-elevate-up"
									(click)="selectAccount(account)">
									<div class="symbol symbol-45px me-5">
										<div class="symbol-label fs-3 bg-light-primary text-primary">
											{{ getAccountInitials(account) }}
										</div>
									</div>
									<div class="flex-grow-1">
										<a class="text-gray-900 fw-bold text-hover-primary fs-6">
											{{ getAccountDisplayName(account) }}
										</a>
										<span class="text-muted fw-semibold d-block fs-7">{{ account.email }}</span>
									</div>
									<button type="button" 
											class="btn btn-icon btn-sm btn-light-danger"
											(click)="removeSavedAccount($event, account)"
											title="Eliminar cuenta">
										<i class="ki-duotone ki-cross fs-2">
											<span class="path1"></span>
											<span class="path2"></span>
										</i>
									</button>
								</div>
							</div>

							<div class="text-center">
								<button type="button" 
										class="btn btn-light-primary w-100"
										(click)="useAnotherAccount()">
									<i class="ki-duotone ki-user-square fs-2 me-2">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
									</i>
									Usar otra cuenta
								</button>
							</div>
						</div>

						<!-- Paso 1: Ingresar email -->
						<div *ngIf="currentStep === LoginStep.EMAIL" class="fade-in">
							<div class="text-center mb-11">
								<h1 class="text-gray-900 fw-bolder mb-3">Iniciar sesión</h1>
								<div class="text-gray-500 fw-semibold fs-6">Ingresa tu correo electrónico</div>
							</div>

							<form [formGroup]="emailForm" (ngSubmit)="onEmailSubmit()" class="form w-100">
								<div class="fv-row mb-8">
									<label class="form-label fs-6 fw-bolder text-gray-900">Email</label>
									<input class="form-control bg-transparent" 
										type="email" 
										formControlName="email"
										placeholder="ejemplo@empresa.com" 
										autocomplete="email" />
									<div *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched" 
										class="fv-plugins-message-container">
										<div class="fv-help-block">
											<span *ngIf="emailForm.get('email')?.errors?.['required']">El email es requerido</span>
											<span *ngIf="emailForm.get('email')?.errors?.['email']">Ingresa un email válido</span>
										</div>
									</div>
								</div>

								<div *ngIf="errorMessage" class="alert alert-danger mb-8">
									<div class="d-flex align-items-center">
										<i class="ki-duotone ki-information-5 fs-2x text-danger me-3">
											<span class="path1"></span>
											<span class="path2"></span>
											<span class="path3"></span>
										</i>
										<div class="flex-grow-1">{{ errorMessage }}</div>
									</div>
								</div>

								<div class="d-grid mb-10">
									<button type="submit" 
											class="btn btn-primary"
											[disabled]="loading">
										<span *ngIf="!loading">Continuar</span>
										<span *ngIf="loading" class="indicator-progress">
											Validando... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
										</span>
									</button>
								</div>
							</form>
						</div>

						<!-- Paso 2: Ingresar contraseña -->
						<div *ngIf="currentStep === LoginStep.PASSWORD" class="fade-in">
							<div class="text-center mb-11">
								<div class="symbol symbol-75px mb-5 mx-auto shadow-sm border-gray-700">
									<div class="symbol-label fs-1 bg-primary text-white fw-bold">
										{{ selectedAccount ? getAccountInitials(selectedAccount) : userFirstName.charAt(0).toUpperCase() }}
									</div>
								</div>
								<h1 class="text-gray-900 fw-bolder mb-3">Hola{{ userFirstName ? ', ' + userFirstName : '' }}</h1>
								<div class="text-gray-500 fw-semibold fs-6">
									{{ emailForm.get('email')?.value }}
								</div>
							</div>

							<form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()" class="form w-100">
								<div class="fv-row mb-8">
									<label class="form-label fs-6 fw-bolder text-gray-900">Contraseña</label>
									<input class="form-control bg-transparent" 
										type="password" 
										formControlName="password"
										placeholder="Ingresa tu contraseña"
										autocomplete="current-password" />
									<div *ngIf="passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched" 
										class="fv-plugins-message-container">
										<div class="fv-help-block">
											<span *ngIf="passwordForm.get('password')?.errors?.['required']">La contraseña es requerida</span>
											<span *ngIf="passwordForm.get('password')?.errors?.['minlength']">Mínimo 6 caracteres</span>
										</div>
									</div>
								</div>

								<div *ngIf="errorMessage" class="alert alert-danger mb-8">
									<div class="d-flex align-items-center">
										<i class="ki-duotone ki-information-5 fs-2x text-danger me-3">
											<span class="path1"></span>
											<span class="path2"></span>
											<span class="path3"></span>
										</i>
										<div class="flex-grow-1">{{ errorMessage }}</div>
									</div>
								</div>

								<div class="d-flex flex-stack flex-wrap gap-3 fs-base fw-semibold mb-8">
									<div></div>
									<a routerLink="/forgot-password" class="link-primary">¿Olvidaste tu contraseña?</a>
								</div>

								<div class="d-grid mb-10">
									<button type="submit" 
											class="btn btn-primary"
											[disabled]="loading">
										<span *ngIf="!loading">Ingresar</span>
										<span *ngIf="loading" class="indicator-progress">
											Verificando... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
										</span>
									</button>
								</div>
							</form>
						</div>

						<!-- Paso 3: Código 2FA -->
						<div *ngIf="currentStep === LoginStep.TWO_FACTOR" class="fade-in">
							<div class="text-center mb-11">
								<div class="mb-5">
									<i class="ki-duotone ki-shield-tick fs-5x text-primary">
										<span class="path1"></span>
										<span class="path2"></span>
									</i>
								</div>
								<h1 class="text-gray-900 fw-bolder mb-3">Verificación en dos pasos</h1>
								<div class="text-gray-500 fw-semibold fs-6 mb-5">
									Ingresa el código de 6 dígitos que enviamos a tu correo
								</div>
								<div class="text-gray-700 fw-bold fs-7">
									{{ emailForm.get('email')?.value }}
								</div>
							</div>

							<form [formGroup]="twoFactorForm" (ngSubmit)="onTwoFactorSubmit()" class="form w-100">
								<div class="fv-row mb-8">
									<label class="form-label fs-6 fw-bolder text-gray-900">Código de verificación</label>
									<input class="form-control bg-transparent text-center fs-2x letter-spacing-2" 
										type="text" 
										formControlName="code"
										placeholder="000000"
										maxlength="6"
										autocomplete="one-time-code" />
									<div *ngIf="twoFactorForm.get('code')?.invalid && twoFactorForm.get('code')?.touched" 
										class="fv-plugins-message-container">
										<div class="fv-help-block">
											<span *ngIf="twoFactorForm.get('code')?.errors?.['required']">El código es requerido</span>
											<span *ngIf="twoFactorForm.get('code')?.errors?.['pattern']">Ingresa un código de 6 dígitos</span>
										</div>
									</div>
								</div>

								<div *ngIf="errorMessage" class="alert alert-danger mb-8">
									<div class="d-flex align-items-center">
										<i class="ki-duotone ki-information-5 fs-2x text-danger me-3">
											<span class="path1"></span>
											<span class="path2"></span>
											<span class="path3"></span>
										</i>
										<div class="flex-grow-1">{{ errorMessage }}</div>
									</div>
								</div>

								<div class="d-grid mb-10">
									<button type="submit" 
											class="btn btn-primary"
											[disabled]="loading">
										<span *ngIf="!loading">Verificar</span>
										<span *ngIf="loading" class="indicator-progress">
											Verificando... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
										</span>
									</button>
								</div>

								<div class="text-center text-muted text-uppercase fw-semibold mb-5">o</div>

								<div class="text-center">
									<button type="button" class="btn btn-link">Reenviar código</button>
								</div>
							</form>
						</div>

						<!-- Botón para regresar -->
						<div *ngIf="canGoBack" class="text-center">
							<button type="button" 
									class="btn btn-icon btn-primary"
									(click)="goBack()">
								<i class="fa fa-angle-left fs-2 me-2">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</button>
						</div>

						<!-- Footer -->
						<div class="text-gray-500 text-center fw-semibold fs-6 mt-10">
							¿No tienes una cuenta?
							<a routerLink="/register" class="link-primary">Regístrate aquí</a>
						</div>
						
					</div>
					<!--end::Wrapper-->
				</div>
				<!--end::Content-->
			</div>
			<!--end::Authentication - Sign-in-->
		</div>
		<!--end::Main-->